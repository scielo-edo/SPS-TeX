%\RequirePackage[xetex,chicagofootnotes]{tipografia} % desabilitado chicagofootnotes para customizar as notas de rodape
\RequirePackage[xetex]{tipografia}
%\RequirePackage[standart,sempontinhos]{toc}

\RequirePackage{anyfontsize}
\RequirePackage{changepage}
\DisemulatePackage{setspace}
\RequirePackage{setspace}

\RequirePackage{hedraextra}
\RequirePackage{penalidades}
\RequirePackage{graficos}
\RequirePackage{hedralogo}
\RequirePackage{hifensextras}
\RequirePackage{aparatos}
\RequirePackage{tabelas}
\RequirePackage{versos}
\RequirePackage{abstract}
\RequirePackage{amsmath,amsfonts,amsthm} % Math packages
%\RequirePackage[hang, small,labelfont=bf,up,textfont=it,up]{caption} % Custom captions under/above floats
\RequirePackage{epstopdf}                       % Converts .eps to .pdf
\RequirePackage{subfig}                         % Subfigures
\RequirePackage{booktabs}                       % Nicer tables
\RequirePackage{fix-cm}                         % Custom fontsizes
\RequirePackage{ctable}
\RequirePackage{textcase}
\RequirePackage{etoolbox}
\RequirePackage{flushend}
\RequirePackage{mdframed}
\RequirePackage{multicol}
\RequirePackage[hyphens]{url}

\RequirePackage{xeCJK}
\RequirePackage[labelfont=normalfont,textfont=normalfont]{caption}
\RequirePackage{hyphenat}
\RequirePackage{verse}
\RequirePackage{seqsplit}
\RequirePackage{lscape}
\RequirePackage{amssymb}
\RequirePackage{mathtools}
\RequirePackage{enumitem}
\RequirePackage{array}
\RequirePackage{multirow}
\RequirePackage{pbox}
\RequirePackage{longtable}
\RequirePackage[pdfpagelabels,implicit=false,hidelinks,hyperfootnotes=false]{hyperref} % configurar pagina inicial do pdf

% mathml to tex
\RequirePackage{bm} % bold
\RequirePackage{pmml-new} % math template
\RequirePackage{unicode-math}


%% Gerais %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% fontes chinesas
\setCJKmainfont{SimSun}
\setCJKsansfont{SimHei}
\setCJKmonofont{FangSong}

% math
\setmathfont{XITS Math}

% remove label automatico das tabelas
\captionsetup{justification=raggedright, singlelinecheck=false}
\captionsetup[table]{labelformat=empty}

% remove padding entre colunas da tabela
\setlength\tabcolsep{0.005\textwidth}

% includegraphics maxwidth
\def\maxwidth#1{\ifdim\Gin@nat@width>#1 #1\else\Gin@nat@width\fi}

% table columns
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

% attrib verse
%\newcommand{\attrib}[1]{%
%\nopagebreak{\raggedleft\footnotesize #1\par}}
\renewcommand{\poemtitlefont}{\normalfont\large\itshape\centering}

% override footnotes (tipografia.sty)
\setlength{\footnotemargin}{1mm}
\renewcommand*{\footnoterule}{
  \vfill %
  \kern 3mm %
  \hrule width \columnwidth %
  \kern 0.4mm %
}

% bibliografia
\newcommand{\scieloReferencesItem}[1]{
\begin{spacing}{1.005}
\fontsize{8}{9.6}\selectfont\item #1~
\end{spacing}
\vspace*{0.5mm}
}%\MakeTextLowercase{\textsc{#1}}]}
%\newcommand{\bibliotitle}[1]{
%\begin{spacing}{1.005}
%\hangindent=2em
%\hangafter=1
%\fontsize{9}{10.8}\selectfont
%{\noindent#1~}
%\end{spacing}
%\vspace*{1mm}
%}

\newenvironment{scieloReferencesContainer}[1][Bibliografia]{%
  \ifthenelse{\equal{#1}{}}%
      {\relax}{\section*{{#1}}\vspace{0mm}}
      \fontsize{8}{9.6}\selectfont
      \begin{enumerate}[itemindent=0mm,labelsep=0mm,leftmargin=5mm,labelwidth=5mm,align=left,itemsep=0mm]{
      
      }
}%
{%
  \end{enumerate} 
  \normalsize
}

% footnotes
\newcommand{\scieloTitleFn}[4]{% {label}{description}{footnotemarkindex}{use footnotemark}
\footnotemark[#3]
}%

\newcommand{\scieloContributorFn}[4]{% {label}{description}{footnotemarkindex}{use footnotemark}
\footnotemark[#3]
}%

\newcommand{\scieloBodyFn}[4]{% {label}{description}{footnotemarkindex}{use footnotemark}
\ifx&#4&%
\protect\footnote{#2}
\else
\protect\footnotemark[#3]
\fi
}%

\newcommand{\scieloCorrespFn}[4]{% {label}{description}{footnotemarkindex}{use footnotemark}
\footnotemark[#3]
}%

% exibicao da seção
\newcommand{\scieloSectionContainer}[1]{%
\section*{#1}
}%
\newcommand{\scieloSubSectionContainer}[1]{%
\subsection*{#1}
}%

% exibicao dos creditos do documento
\newcommand{\scieloLicenseContainer}[1]{%
\vspace*{3mm}
\noindent\fontsize{6}{7.2}\selectfont#1
}%

% exibicao do abstract
\newcommand{\scieloAbstractContainer}[4]{%
\renewcommand{\abstractname}{}
\begin{spacing}{1.02}
\begin{abstract}
\vspace*{-1.2mm}
#2\par
\scieloKeywordsContainer{#3}{#4}
\end{abstract}
\end{spacing}
\vspace*{1.5mm}
}%

% exibicao keywords abstract
\newcommand{\scieloKeywordsContainer}[2]{%
\vspace*{2.9mm}
{\timesnewromanfont\fontsize{9}{10.8}\selectfont{\textbf{#1} \textit{#2}}}
}%

% image one col command
\newcommand{\scieloImageContainerOneCol}[3]{% {width}{url}{caption}
\vspace{8mm}
\centerline{
\includegraphics[width=\maxwidth{#1}]{#2}
}
\ifx&#3&%
\else
\captionof{figure}{#3} 
\fi
\vspace{8mm}
}%

% image two col command
\newcommand{\scieloImageContainerTwoCol}[2]{% {url}{caption}
\begin{figure*}
\centerfloat
\includegraphics[width=\maxwidth{\textwidth}]{#1}
\ifx&#2&%
\else
\caption{#2} 
\fi
\end{figure*}
}%

% image inline  command
\newcommand{\scieloImageInlineContainer}[1]{% {url}{caption}
{
\centering{
\includegraphics[width=\maxwidth{0.5\textwidth},height=0.7cm,keepaspectratio]{#1}
}
}
}%

% fontes
\newfontfamily\timesnewromanfont{Times New Roman}

% footer font size
\renewcommand{\footnotesize}{\fontsize{8}{9.6}\selectfont}
%\renewcommand{\foottextfont}{\fontsize{8}{9.6}\selectfont}

% paragrafo
\setlength\parindent{4.8mm}
\setlength{\parskip}{0mm}%

% espaçamento dos floats figure e table
\setlength{\textfloatsep}{8mm}
\setlength{\dbltextfloatsep}{8mm}
\setlength{\dblfloatsep}{8mm}

\renewcommand{\thefigure}{\arabic{figure}}

\epigraphtextposition{flushleft}
\epigraphsourceposition{flushright}
\epigraphfontsize{\footnotesize}
\setlength{\epigraphrule}{0pt}
\setlength{\epigraphwidth}{.7\textwidth}

\renewcommand*{\@fnsymbol}[1]{%
  % Änderungen:
  % * Symbol "**" an Position 2 verschoben.
  % * Symbol "***" eingefügt.
  % * Symbole mit \dagger entfernt.
  \ensuremath{%
    \ifcase#1%
    \or
      {*}%
    \or
      \ddagger
    \or
      \mathsection
    \or
      \mathparagraph
    \or
      \ddagger\ddagger
    \else
      \@ctrerr
    \fi
  }%
}

%% ctable + longtable %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% http://tex.stackexchange.com/questions/88304/multipage-tables-with-ctable-package
\newif\if@ctbl@long
\define@key{ctbl}{long}[]{\@ctbl@longtrue}

\long\def\foo#1\sbox#2!!{%
\long\expandafter\def\csname\string\ctable\endcsname[##1]##2##3##4{%
#1\if@ctbl@long\ctbl@long\fi\sbox#2}}

\expandafter\expandafter\expandafter\foo
\csname\string\ctable\endcsname[#1]{#2}{#3}{#4}!!

\def\ctbl@long\fi\sbox#1#2#3\@ctblend{\fi
\ctbl@@long#2%
}

\long\def\ctbl@@long#1#2#3#4#5#6{%
\ctbl@@@long#6%
}

\def\ctbl@@@long#1\begin#2#3#4\end#5{%
\def\@tempa{#5}%
\def\@tempb{tabular}%
\ifx\@tempa\@tempb\else\show\@tempa\ERROR\fi
\begin{longtable}{#3}%
%\caption{\@ctblcaption\ifx\@ctbllabel\empty\else\label{\@ctbllabel}\fi}%
\caption{\@ctblcaption}
\endfirsthead
\caption*{\@ctblcaption\space(continued)}%
\endhead
#4\end{longtable}}
%% ctable + longtable %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% END Gerais %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%Template MR %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\DeclareOption{mr}{%




% se showtrims, aumenta o tamanho do stock em 20mm e centraliza para o trim
\@ifclasswith{memoir}{showtrims}{
  \setstocksize{285mm}{200mm} % {height}{width}
  \setpagecc{265mm}{180mm}{*} % {height}{width}{ratio}
}
{
  \setstocksize{265mm}{180mm} % {height}{width}
  \settrimmedsize{\stockheight}{\stockwidth}{*} % {height}{width}{ratio}
  \settrims{0mm}{0mm} % {top}{foredge}
}

% ao especificiar a largura do spine e fore-edge margin a largura do blocksize é calculado automaticamente
\setlrmarginsandblock{15mm}{12mm}{*} % {spine}{edge}{ratio}

% ao especificiar a margem top e bottom a altura do blocksize é calculado automaticamente
\setulmarginsandblock{22mm}{12mm}{*} % {upper}{lower}{ratio
  
% altura do header e footer
\setheadfoot {2.31mm}{0mm} % {headheight}{footskip}

% margens do header
\setheaderspaces {9.02mm}{*}{*} % {headdrop}{headsep}{ratio}

% não possui margin notes
\setlength{\marginparwidth}{0mm}
\setlength{\marginparsep}{0mm}
\setlength{\marginparpush}{0mm}

% compila as alterações no layout
\checkandfixthelayout




%%% Estilo de página %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makepagestyle{estilo}
  
%\makeevenfoot{plain}{}{\footnotesize\thepage}{}{}
%\makeoddfoot{plain}{}{\footnotesize\thepage}{}{}

% header
\pagestyle{estilo}
\makeevenhead{estilo}{\fontsize{7}{8.4}\selectfont\thepage}{\fontsize{7}{8.4}\selectfont\scieloHeaderAuthorAbbrev}{\fontsize{7}{8.4}\selectfont\textit{Materials Research}}
\makeoddhead{estilo}{\fontsize{7}{8.4}\selectfont{\scieloHeaderArticleRef}}{\fontsize{7}{8.4}\selectfont{\scieloHeaderArticleTitle}}{\fontsize{7}{8.4}\selectfont\thepage} 

%%% END Estilos de página %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%% Abertura %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\AtBeginDocument{%

\input{BEFORE-BEGINDOC-COMMANDS.tex}

\scieloDefineFootnotes

% align abstract title left
\renewcommand{\absnamepos}{flushleft}  

% abstract font size
%\renewcommand{\abstractnamefont}{\fontsize{11}{13.2}\selectfont}
\renewcommand{\abstracttextfont}{\fontsize{9}{10.8}\selectfont}

% remove abstract title
\renewcommand{\abstractname}{}
\renewcommand{\absnamepos}{empty}  

% abstract margins
\setlength{\absparindent}{5.9mm}
\setlength{\absleftindent}{12.25mm}
\setlength{\absrightindent}{12.25mm}

% sections
\setsecindent{0mm}
\setbeforesecskip{0mm} % nao funciona
\setaftersecskip{1.7mm}%
\setbeforesubsecskip{0cm}% nao funciona
\setaftersubsecskip{1.7mm}%
\setbeforesubsubsecskip{0mm}% nao funciona
\setaftersubsubsecskip{1.2mm}%
\setsecheadstyle{\fontsize{11}{13.2}\selectfont\flushleft\textbf}%
\setsubsecheadstyle{\fontsize{10.5}{12.6}\selectfont\flushleft\textit}%
\setsubsubsecheadstyle{\fontsize{9}{10.8}\selectfont\flushleft\textit}%
%\setsecheadstyle{\fontsize{10}{12}\selectfont\flushleft\bfseries}%
%\setsubsecheadstyle{\fontsize{9}{10.8}\selectfont\flushleft\bfseries}%
%\setsubsubsecheadstyle{\fontsize{8}{9.6}\selectfont\flushleft\bfseries}%

\setcolsepandrule{5.08mm}{0mm} % {colsep}{thickness}

% primeira pagina nao tem header
\thispagestyle{empty}

% sobe a altura do header (headsep + headheight)
\vspace*{-17mm}


\noindent
\begin{minipage}[t]{0.5\textwidth}

  {\fontsize{7}{8.4}\selectfont{\textit{Materials Research}. \scieloArticleRef}}
  \vspace*{-0.5mm}
  \\\noindent{\fontsize{7}{8.4}\selectfont{\scieloArticlePubIdType: \scieloArticleUrl  }}

\end{minipage}
\hfill
\begin{minipage}[t]{0.3\textwidth}

  \raggedleft
  \fontsize{7}{8.4}\selectfont{\copyright ~ \scieloCopyrightYear}

\end{minipage}

\vspace{9.4mm}

\begin{adjustwidth}{12.25mm}{12.25mm}
\begin{center}

\begin{bfseries}

% titulo do artigo
\begin{spacing}{1.4}
{\fontsize{11}{13.2}\selectfont{\scieloArticleTitle}}
\end{spacing}

% traducoes dos titulos
\ifdef\scieloArticleTitleTranslation
{
  \vspace*{1mm}
  \begin{spacing}{1.4}
  {\fontsize{11}{13.2}\selectfont{\scieloArticleTitleTranslation}}
  \end{spacing}
}{}


\vspace{1.9mm}

% autores
{
\begin{spacing}{1.8}
{\fontsize{9}{10.8}\selectfont{\textit{\scieloAuthor}}}
\end{spacing}
}

\vspace{2.2mm}

\end{bfseries}

% notas dos autores
\ifx\scieloContributorsFootNotes\empty
\else
    \begin{spacing}{1.02}
    {\fontsize{9}{10.8}\selectfont{\textit{\scieloContributorsFootNotes}}}
    \end{spacing}
    \vspace{5.4mm}
\fi

% received / revised
\ifdef\scieloDates
{
  {\fontsize{8}{9.6}\selectfont{\scieloDates}}
  \vspace{6.5mm}
}{}

\end{center}


\end{adjustwidth}


\begin{spacing}{1.12}


} % END AtBeginDocument


\AtEndDocument{%

\end{spacing}

}

} % \DeclareOption{mr}{


%END MR %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\DeclareOption{trimframe}{\renewcommand{\marcadecorte}{\trimFrame}}
\DeclareOption{sembinding}{\setbinding{0mm}}
\DeclareOption{semcabeco}{
      \setulmargins{*}{*}{1.9}
      \headsep=0pt}

\DeclareOption{numberinsection}{%
\setcounter{secnumdepth}{4}
\renewcommand{\thesection}{\arabic{section}}
\renewcommand{\thesubsection}{\thesection.\arabic{subsection}}
\let\l@subsection\l@section
\let\l@section\l@chapter}

\ProcessOptions